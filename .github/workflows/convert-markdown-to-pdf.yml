name: Convert All Markdown to PDF

on:
  push: # Trigger on any push to the repository
    branches:
      - main # Ensure it triggers on the main branch
  workflow_dispatch: # Allow manual triggering of the workflow

jobs:
  convert-md-to-pdf:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      # Step 2: Install Pandoc and Dependencies
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive texlive-xetex texlive-fonts-recommended texlive-latex-extra

      # Step 3: Convert All Markdown Files in Resumes Folder to PDFs
      - name: Convert Markdown Files to PDF
        run: |
          mkdir -p converted-pdfs
          for file in resumes/*.md; do
            [ -e "$file" ] || continue
            pandoc "$file" -o "converted-pdfs/$(basename "${file%.md}.pdf")" --css assets/github.css --pdf-engine=xelatex
          done

      # Step 4: Upload PDFs as Artifacts
      - name: Upload PDFs
        uses: actions/upload-artifact@v3
        with:
          name: Markdown PDFs
          path: converted-pdfs/*.pdf
