name: Convert All Markdown to PDF with Proper Formatting

on:
  push:
    paths:
      - "resumes/*.md" # Trigger when Markdown files in the resumes folder are updated
  workflow_dispatch: # Allow manual execution

jobs:
  convert-md-to-pdf:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      # Step 2: Install Dependencies (Pandoc and LaTeX)
      - name: Install Pandoc and LaTeX Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive texlive-xetex texlive-fonts-recommended texlive-latex-extra

      # Step 3: Convert Markdown Files to PDF
      - name: Convert Markdown Files to PDF
        run: |
          mkdir -p converted-pdfs
          for file in resumes/*.md; do
            [ -e "$file" ] || continue
            pandoc "$file" -o "converted-pdfs/$(basename "${file%.md}.pdf")" \
              --from markdown \
              --to pdf \
              --pdf-engine=xelatex \
              --css assets/github.css
          done

      # Step 4: Upload PDFs as Artifacts
      - name: Upload PDFs
        uses: actions/upload-artifact@v3
        with:
          name: Markdown PDFs
          path: converted-pdfs/*.pdf
